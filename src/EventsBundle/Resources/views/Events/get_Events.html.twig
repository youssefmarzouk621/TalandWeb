{% extends "default/LayoutFront.html.twig" %}

{% block header %}

    <div class="bradcumbContent">

        {% if connected != null %}
            <p style="position: relative;top: -15px;">Create your own</p>
            <a href="{{ path('add_events') }}" style="background: none;border: none;position: relative;top: -15px;"><h2>Event</h2></a>
        {% else %}
            <p style="position: relative;top: -15px;">Connect to create your own Event</p>
            <a href="{{ path('fos_user_security_login') }}" style="background: none;border: none;position: relative;top: -15px;"><h2>Login</h2></a>
        {% endif %}
    </div>

{% endblock %}

{% block section %}

    <div style="margin-top: 24px;" class="container">
        <div style="position: relative;left: 226px;margin-bottom: 14px;">
            <form METHOD="POST">
                <input style="width: 60%;display: initial;border-color: black;position: relative;top: 1px;" class="form-control" placeholder="search" name="search">
                <button class="btn btn-outline-dark" type="submit" name="submit"><i class="fa fa-search"></i></button>
            </form>
        </div>
        <div class="row">

            {% for row in result %}
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="single-event-area mb-30">
                        <div class="event-thumbnail">
                            <img style="width: 370px;height: 247px;object-fit: cover;object-position: center;" src="{{ asset('uploads/events/' ~ row.imageName) }}" alt="">
                        </div>
                        <div style="padding: 50px 15px;" class="event-text">

                            {% if connected != null %}

                            {% if connected.id == row.idu.id %}
                                    <a href="{{path('remove_events',{'id':row.idevent})}}" class="btn" style="font-size:18px;color: gray;background: none;position: absolute;bottom: 0px;left: 4px;"><i class="fa fa-trash"></i></a>
                                    <a href="{{path('update_events',{'id':row.idevent})}}" class="btn" style="font-size:18px;color: gray;background: none;position: absolute;bottom: 0px;left: 325px;"><i class="fa fa-edit"></i></a>
                                {% endif %}
                            {% endif %}
                            <div style="position: relative;top: -30px">
                                <h4>{{ row.name }}</h4>
                                <div style="margin-top: 14px;margin-bottom: 22px;" class="event-meta-data">
                                    <a href="#" class="event-places">{{ row.date|date("d/m/Y") }}</a>
                                </div>
                                <h4 style="margin-bottom: -1px;">{{ row.location }}</h4>

                                <div  class="event-text">
                                    {% if row.specMax-row.nbrspectateurevent==0 %}
                                        <div class="row">
                                            <div class="col">
                                                <h4 style="font-size: 10px;font-style: normal;">No places available</h4>
                                                <button disabled="disabled" style="opacity: .7;margin-top: 9px;" href="#" class="btn btn-light">Spectate</button>
                                            </div>
                                        </div>

                                    {% else %}

                                        <div class="row">
                                            <div class="col">
                                                <h4 id="valueP{{ row.idevent }}" style="font-size: 10px;font-style: normal;">{{ row.specMax-row.nbrspectateurevent }} places available</h4>
                                                <input hidden id="placesP{{ row.idevent }}" value="{{ row.specMax-row.nbrspectateurevent }}">
                                                <button id="partP{{ row.idevent }}" onclick="spectate({{ row.idevent }},1);" style="opacity: .7;margin-top: 9px;" href="#" class="btn btn-light">Spectate</button>
                                            </div>
                                        </div>


                                    {% endif %}
                                </div>

                                <a href="{{path('SingleEvent',{'id':row.idevent})}}" class="btn see-more-btn">See Event</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}




        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ asset('FrontOffice/js/notify.min.js') }}"></script>
    <script>
        function spectate(idevent,type) {
            $.ajax({
                url: 'AddSpec/' + idevent ,
                success: function (data) {

                    if (data == "ajout"){
                        if (type==1){
                            var nbr = parseInt(document.getElementById('placesP'.concat(idevent)).value)-1;
                            document.getElementById('valueP'.concat(idevent)).innerText = "".concat(nbr,' places available');
                            document.getElementById('partP'.concat(idevent)).innerText = "Spectated";
                            var ch='#partP'.concat(idevent);
                            $(ch).notify("Participated!", "success");
                        }else{
                            var nbr = parseInt(document.getElementById('places'.concat(idevent)).value)-1;
                            document.getElementById('value'.concat(idevent)).innerText = "".concat(nbr,' places available');
                            document.getElementById('part'.concat(idevent)).innerText = "Spectated";
                            var ch='#part'.concat(idevent);
                            $(ch).notify("Spectated!", "success");
                        }
                    }
                    if (data == "exists") {
                        console.log("plz");
                        var ch='#partP'.concat(idevent);
                        $(ch).notify(
                            "Already spectated !",
                            { position:"bottom" }
                        );
                    }

                },
                error: function (xhr, textStatus, errorThrown) {
                    console.log("Ajax request failed.");
                }
            });
        }


    </script>
{% endblock %}