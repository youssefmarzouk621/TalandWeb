<?php

namespace CalendarZiedBundle\Repository;

/**
 * MessageRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class MessageRepository extends \Doctrine\ORM\EntityRepository
{
    public function findmessage($eventdescription)
    {
        return $this->createQueryBuilder('c')
        ->select('c')
        ->where('c.eventdescription=:eventdescription' )
        ->setParameter('eventdescription', $eventdescription)
            ->orderBy('c.idmessage', 'ASC')
     ->getQuery()
     ->getResult();
    }

    public function findmessage1($eventdescription)
    {
        return $this->createQueryBuilder('c')
            ->select('c')
            ->where('c.eventdescription=:eventdescription' )
            ->setParameter('eventdescription', $eventdescription)
            ->orderBy('c.idmessage', 'ASC')
            ->getQuery()
            ->getResult();
    }

public function findmessage2($idu)
{
    $query=$this->createQueryBuilder('v')
        ->select('v')
        ->join('v.fos_user','t')
        ->where('t.nomT=:film' )
        ->setParameter('film', $idu)
        ->getQuery();
    return $query->getSingleScalarResult();
}

public function messagenotseen($idreceiver)
    {
        $number=1;
        $qb = $this->createQueryBuilder('v')
            ->where('v.seen = :seen')
            ->andWhere('v.idreceiver=:idreceiver')
            ->setParameter('idreceiver', $idreceiver)
            ->setParameter('seen', $number)
            ->getQuery();
        return $qb->getResult();
    }

    public function messagenotseen2($idreceiver)
    {
        $number=1;
        $qb = $this->createQueryBuilder('v')
            ->where('v.seen = :seen')
            ->andWhere('v.idreceiver=:idreceiver')
            ->setParameter('idreceiver', $idreceiver)
            ->setParameter('seen', $number)
            ->orderBy('v.dateenvoi', 'DESC')
            ->getQuery();
        return $qb->getResult();
    }
}
